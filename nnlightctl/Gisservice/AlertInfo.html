<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <title>灯具道路地理信息--警报信息</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../css/admin.css"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css"/>
    <style type="text/css">
        .search-info{
            width: 100%;
            height: 40px;
        }
        .search-info select{
            width: 130px;
            height: 28px;
            border-radius: 2px;
        }
        .search-info label{
            margin-right: 5px;
        }
        .search-info input{
            height: 28px;
            width: 150px;
            color: #999;
            padding: 0 5px;
            box-sizing: border-box;
        }
        .search-info button{
            width: 80px;
            height: 28px;
            background: #2D8DE7;
            border: none;
            color: #fff;
            border-radius: 2px;
        }
        .table th, .table td{
            padding: 2px 2px;
        }
    </style>
</head>
<body>
<div class="page-container" style="background: #F6F6F6;padding: 15px 10px;">
    <div style="width:100%;height:450px">
        <div class="search-info">
            <label>
                类型：
                <select name="infoType" id="infoType">
                    <option value="11">意外亮灯</option>
                    <option value="12">意外灭灯</option>
                    <option value="13">线路过流</option>
                    <option value="14">线路过压</option>
                    <option value="15">线路欠压</option>
                    <option value="16">配电柜断电</option>
                    <option value="17">配电柜缺相</option>
                    <option value="18">配电柜漏电</option>
                    <option value="19">功率因数越限</option>
                    <option value="110">柜门开启</option>
                    <option value="111">配电柜倾斜</option>
                    <option value="112">配电柜进水</option>
                    <option value="113">配电柜雷击</option>
                    <option value="114">手自控切换</option>
                    <option value="115">外部控制器</option>
                    <option value="116">自定义报警</option>
                </select>
            </label>
            <label>
                级别：
                <select  name="infoLevel" id="infoLevel">
                    <option value="1">低</option>
                    <option value="2">中</option>
                    <option value="2" selected>高</option>
                </select>
            </label>
            <label>
                名称：
                <input placeholder="请输入名称" name="infoName" value="" id="infoName"/>
            </label>
            <label>
                <button id="search-btn">搜索</button>
            </label>
        </div>
        <!--<div style="width:140px" class="f-l">-->
            <!--<h4 class="f-18 tit"><span class="Hui-iconfont">&#xe667;</span><span class="pl-10">警报类型</span>-->
            <!--</h4>-->
            <!--<div class="ucnav" style="height: 410px; overflow: auto;">-->
                <!--<h2 class="navtit ucgrzx" ref="0"><a href="javascript:void(0)" onclick="findAram(1)">全部</a></h2>-->
                <!--<h2 class="navtit ucgrzx" ref="1"><i class="Hui-iconfont">&#xe6d7;</i><a href="javascript:void(0)"-->
                                                                                         <!--onclick="findAram(10)">控制柜警报</a>-->
                <!--</h2>-->
                <!--<ul class="ucsub tab1">-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(11)">意外亮灯</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(12)">意外灭灯</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(13)">线路过流</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(14)">线路过压</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(15)">线路欠压</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(16)">配电柜断电</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(17)">配电柜缺相</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(18)">配电柜漏电</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(19)">功率因数越限</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(110)">柜门开启</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(111)">配电柜倾斜</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(112)">配电柜进水</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(113)">配电柜雷击</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(114)">手自控切换</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(115)">外部控制器</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(116)">自定义报警</a></li>-->
                <!--</ul>-->
                <!--<h2 class="navtit ucgrzx" ref="2"><i class="Hui-iconfont">&#xe6d7;</i><a href="javascript:void(0)"-->
                                                                                         <!--onclick="findAram(20)">常规灯具警报</a>-->
                <!--</h2>-->
                <!--<ul class="ucsub tab2">-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(21)">灯具熄灭</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(22)">电源故障</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(23)">补偿电容</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(24)">灯杆漏电</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(25)">节点丢失</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(26)">继电器故障</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(27)">灯具过流</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(28)">灯具过压</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(29)">灯具欠压</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(210)">高温</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(211)">灯具寿命</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(212)">检修口门</a></li>-->
                    <!--<li><a href="javascript:void(0)" onclick="findAram(213)">灯杆倾斜</a></li>-->
                <!--</ul>-->
            <!--</div>-->
        <!--</div>-->
        <div style="width:100%;height:430px;overflow-y:auto;" >
            <!--<h4 class="f-18 tit"><span class="Hui-iconfont">&#xe667;</span><span class="pl-10">警报列表</span></h4>-->
            <table class="table table-border table-bordered table-bg table-hover table-sort" id="alertinfo">
                <thead>
                <tr class="text-l">
                    <th>序号</th>
                    <th>状态</th>
                    <th>等级</th>
                    <th>设备名称</th>
                    <th>设备编码</th>
                    <th>警报类型</th>
                    <th>时间</th>
                    <th>次数</th>
                </tr>
                </thead>
                <tbody id="aramList">

                </tbody>
            </table>
        </div>
        <!--<div style="width:195px;height:450px;border-left:1px solid #dedede;" class="f-r">-->
            <!--<h4 class="f-18 tit"><span class="Hui-iconfont">&#xe667;</span><span class="pl-10">详细信息</span></h4>-->
            <!--<table class="table table-border table-bordered table-bg table-hover table-sort">-->
                <!--<thead>-->
                <!--<tr class="text-c">-->
                    <!--<th>名称</th>-->
                    <!--<th>数据</th>-->
                <!--</tr>-->
                <!--</thead>-->
                <!--<tbody id="infoshow">-->
                <!--</tbody>-->
            <!--</table>-->
        <!--</div>-->
    </div>

</div>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/api/requestRoot.js"></script>
<script type="text/javascript" src="../js/api/ajaxScript.js"></script>
<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
<script type="text/javascript">
  $(function () {
    $('#search-btn').click(function () {
      console.log($('#infoLevel').val())
      console.log($('#infoType').val())
      console.log($('#infoName').val())
    })
    findAram({}) // 刷新列表
    // $(".navtit").click(function () {
    //   var _this = $(this);
    //   _this.children("i").toggleClass('active-i')
    //   if (!_this.children("i").hasClass("active-i")) {
    //     _this.children("i").html("&#xe6d7;");
    //   } else {
    //     _this.children("i").html("&#xe6d5;");
    //   }
    //   // $(".ucnav .Hui-iconfont").html("&#xe6d7;");
    //   // _this.children("i").html("&#xe6d5;");
    //   // $(".ucsub").hide();
    //   if (_this.attr("ref") == 1) {
    //     $(".tab1").toggle();
    //   } else if (_this.attr("ref") == 2) {
    //     $(".tab2").toggle();
    //   }
    // });

  });

  function get (type) { // 之前右侧部分详细信息
    ajaxRequest("post", "/api/alarm/getAlarm", {"id": parseInt(type)}, function (data) {
      var sta;
      if (data.body.data) {
        if (data.body.data.length) {
          if (data.body.data[0].state == 0) {
            sta = "报警中";
          } else if (data.body.data[0].state == 1) {
            sta = "已解除";
          } else if (data.body.data[0].state == 2) {
            sta = "已处理";
          } else if (data.body.data[0].state == 3) {

          } else {
            sta = "未定义";
          }
        }
      }
      var StrHtml = "";
      StrHtml += "<tr><td class=\"text-r\">类型</td><td class=\"c-red\">" + data.body.data[0].alarmSource + "</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">状态</td><td class=\"c-red\">" + sta + "</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">报警时间</td><td>" + formatDate(data.body.data[0].alarmTime) + "</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">报警编码</td><td>" + data.body.data[0].codeNumber + "</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">报警信息</td><td>" + data.body.data[0].msg + "</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">解除时间</td><td>" + formatDate(data.body.data[0].removeAlarmTime) + "</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">报警次数</td><td>" + data.body.data[0].alarmCount + "</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">报警等级</td><td>" + data.body.data[0].alarmLevel + "</td></tr>";
      /*StrHtml += "<tr><td class=\"text-r\">道具</td><td>1</td></tr>";
      StrHtml += "<tr><td class=\"text-r\">数据</td><td>05147</td></tr>";*/
      $("#infoshow").html(StrHtml);
    })

  }

  function findAram (param) { // 刷新列表
    $("#aramList").empty();
    // if (type == 1) {
    // } else if (type == 10) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = "";
    // } else if (type == 20) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "";
    // } else if (type == 11) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 1;
    // } else if (type == 12) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 2;
    // } else if (type == 13) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 3;
    // } else if (type == 14) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 4;
    // } else if (type == 15) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 5;
    // } else if (type == 16) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 6;
    // } else if (type == 17) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 7;
    // } else if (type == 18) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 8;
    // } else if (type == 19) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 9;
    // } else if (type == 110) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 10;
    // } else if (type == 112) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 12;
    // } else if (type == 113) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 13;
    // } else if (type == 114) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 14;
    // } else if (type == 115) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 15;
    // } else if (type == 116) {
    //   param["alarmSource"] = "控制柜"
    //   param["ctype"] = 16;
    // } else if (type == 21) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "1";
    // } else if (type == 22) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "2";
    // } else if (type == 23) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "3";
    // } else if (type == 24) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "4";
    // } else if (type == 25) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "5";
    // } else if (type == 26) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "6";
    // } else if (type == 27) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "7";
    // } else if (type == 28) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "8";
    // } else if (type == 29) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "9";
    // } else if (type == 210) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "10";
    // } else if (type == 211) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "11";
    // } else if (type == 212) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "12";
    // } else if (type == 213) {
    //   param["alarmSource"] = "常规灯具"
    //   param["ctype"] = "13";
    // }

    ajaxRequest("post", "/api/alarm/listAlarm", param, function (data) {
      if (data.body.data) {
        if (data.body.data.length > 0) {
          for (var i = 0; i < data.body.data.length; i++) {
            var aramList = data.body.data[i];
            var s;
            $("#aramList").append("<tr class='text-l' onclick='get(" + aramList.id + ")' rel='102'>" +
            "                            <td>" + aramList.codeNumber + "</td>" +
            "                            <td>" + aramList.alarmSource + "</td>" +
            "                            <td>" + aramList.alarmLevel + "</td>" +
            "                            <td>" + formatDate(aramList.removeAlarmTime) + "</td>" +
            "                            <td>" + s + "</td>" +
            "                            <td><a href='javascript:void(0);' style='text-decoration:none' class='ml-10' title='启用' onClick='Relieve(this, " + aramList.id + ")'><i class='Hui-iconfont'>&#xe605;</i></a></td>" +
            "                        </tr>");
          }
        }
      }
    })
  }

  function Relieve (obj, id) {  // 对报警进行操作
    var ctype;
    var alarmSource;
    var param = {};
    ajaxRequest("post", "/api/alarm/getAlarm", {"id": parseInt(id)}, function (data) {
      if (data.body.data) {
        if (data.body.data.length > 0) {
          param["alarmRequestList[0].ctype"] = data.body.data[0].ctype;
          param["alarmRequestList[0].alarmSource"] = data.body.data[0].alarmSource;
          if (data.body.data[0].isUse == 1) {
            param["alarmRequestList[0].isUse"] = 0;
          } else {
            param["alarmRequestList[0].isUse"] = 1;
          }
          layer.confirm('确认要启用警报吗？', function (index) {
            ajaxRequest("post", "/api/alarm/configIsUseAlarm", param, function (data) {
              if (data) {
                if (data.header.code == 1000) {
                  layer.close(index);
                }
              }
            })

          })
        }
      }

    })

  }
</script>
</body>
</html>
