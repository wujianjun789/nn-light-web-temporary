<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <title>灯具地理信息--灯光设置</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../css/admin.css"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css"/>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <style type="text/css">
        .tabBar span.current {
            border-color: #FFB300;
        }

        .tabBar span {
            margin-right: 20px;
            padding: 0;
            font-size: 15px;
        }
        .table th{
            line-height: 18px;
        }
        .table td{
            line-height: 16px;
        }
    </style>
</head>
<body>
<div class="page-container" id="light-set"
     style="max-height: 540px;padding: 20px  15px 0;background-color:rgba(246,246,246,1);">
    <div class="linghtbox clearfix">
        <div class="imgbox"><img src="../bg//lightsbg_0.png" class="imgboximg"/><h4>光亮：<span>0%</span></h4></div>
        <div id="powerange">

            <a onclick="addlights(100)" href="javascript:void(0);" rel="100" class="btn btn-danger radius mt-20"
               style="width:60px;"><span>100%</span></a>
            <a onclick="addlights(80)" href="javascript:void(0);" rel="80" class="btn btn-danger radius mt-20"
               style="width:60px;"><span>80%</span></a>
            <a onclick="addlights(60)" href="javascript:void(0);" rel="60" class="btn btn-danger radius mt-20"
               style="width:60px;"><span>60%</span></a>
            <a onclick="addlights(40)" href="javascript:void(0);" rel="40" class="btn btn-danger radius mt-20"
               style="width:60px;"><span>40%</span></a>
            <a onclick="addlights(20)" href="javascript:void(0);" rel="20" class="btn btn-danger radius mt-20"
               style="width:60px;"><span>20%</span></a>
            <a onclick="addlights(0)" href="javascript:void(0);" rel="0" class="btn btn-danger radius mt-20"
               style="width:60px;"><span>关灯</span></a>

            <input type="range" min="1" max="100" value="0" step="1" name="range" onchange="changerange(this)">
            <p name="rangeval" style='font-size:16px;color:#FFB300;font-weight: bold;padding-top: 10px;'>0</p>
        </div>
    </div>
    <div id="tab-system" class="HuiTab mt-10" style="height: 300px;overflow-y: auto;">
        <div class="tabBar cl">
            <span>灯具数据</span>
            <span>灯杆信息</span>
            <span>灯具信息</span>
        </div>
        <div class="tabCon mt-15">
            <!--<table class="table table-border table-bordered table-bg table-hover table-sort">-->
            <!--<thead>-->
            <!--<tr class="text-l">-->
            <!--<th>开关模块</th>-->
            <!--<th>回路</th>-->
            <!--<th>状态</th>-->
            <!--<th colspan="2" style="position: relative">开关<span id="refreshLoop"></span></th>-->
            <!--</tr>-->
            <!--</thead>-->
            <!--<tbody id="tb">-->
            <!--<tr class="text-l"></tbody>-->
            <!--</table>-->
            <div id="flushLightPowerWrap" style="overflow: auto">
                <table id="flushLightPower" style="width: 435px"
                       class="table table-border table-bordered table-bg table-hover">
                    <thead>
                    <tr class="text-l">
                        <th>参数</th>
                        <th>值</th>
                        <th>单位</th>
                        <th>时间</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <div class="tabCon mt-15">
            <div id="electricEnergyWrap" style="overflow: auto">
                <table id="electricEnergy" style="width: 435px"
                       class="table table-border table-bordered table-bg table-hover">
                    <thead>
                    <tr class="text-l">
                        <th>参数名称</th>
                        <th>对应数据信息</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <div class="tabCon mt-15">
            <div id="eleBoxInfoWrap" style="overflow: auto">
                <table id="eleBoxInfo" style="width: 435px"
                       class="table table-border table-bordered table-bg table-hover">
                    <thead>
                    <tr class="text-l">
                        <th>参数名称</th>
                        <th>对应数据信息</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div><!--tab切换end -->
    </div>
    <!--<div class="lampInfo">-->
    <!--<h4 style="color: #FEB916;">灯具信息：</h4>-->
    <!--</div>-->
    <!--<p class="f-14" style="margin-bottom: 4px"><span>灯具坐标：</span><span id="longitude">经度：116.306681 </span><span-->
    <!--id="latitude">纬度：39.830931</span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>报警信息：</span><span id="alarmMessage">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>通讯方式：</span><span id="communicationMode">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>调光方式：</span><span id="dimmingMode">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>灯具编号：</span><span id="equipmentNumber">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>IMEI：</span><span id="UUID">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>单灯控制器型号：</span><span id="lampModel">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>单灯控制器名称：</span><span id="lampName">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>额定电流：</span><span id="ratedCurrent">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>额定电压：</span><span id="ratedVoltage">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 0"><span>静态功耗：</span><span id="staticPower">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 4px"><span>灯具编号：</span><span id="lightingCode">2012555 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 4px"><span>灯具UUID：</span><span id="uuid">1234567890 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 4px"><span>灯具IMEI：</span><span id="imei">1234567890 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 4px"><span>灯杆号：</span><span id="lamppost">21.56 </span>-->
    <!--</p>-->
    <!--<p class="f-14" style="margin-bottom: 4px"><span>灯头号：</span><span id="lamphead">1234567890 </span></p>-->
    <!--<p class="f-14" style="margin-bottom: 4px"><span>信号强度：</span><span id="signalIntensity">1234567890 </span></p>-->
    <!--<div class="row cl mt-30">
        <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
            <input id="btnSubmit" class="btn btn-primary radius ml-20" type="button" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            <input id="btnCancel" class="btn radius ml-20" type="button" value="&nbsp;&nbsp;关闭&nbsp;&nbsp;">
        </div>
    </div>-->

</div><!--地图弹出内容-->
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/api/requestRoot.js"></script>
<script type="text/javascript" src="../js/api/ajaxScript.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript" src="../js/admin.js"></script>
<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script><!--弹出插件-->
<script type="text/javascript" src="../lib/datatables/1.10.0/jquery.dataTables.min.js"></script><!--表单插件-->
<script type="text/javascript">
  var globalLightId = null;
  var lampInfoMatch = {
    longitude: '经度',
    latitude: '纬度',
    alarmMessage: '报警信息',
    communicationMode: '通讯方式',
    dimmingMode: '调光方式',
    equipmentNumber: '灯具编号',
    IMEI: 'UUID',
    lampModel: '单灯控制器型号',
    lampName: '单灯控制器名称',
    ratedCurrent: '额定电流',
    ratedVoltage: '额定电压',
    staticPower: '静态功耗',
    lightingCode: 'lightingCode',
    mem: '备注'
  }
  var lamppostInfoMatch = {
    equipmentNumber: '灯具编号',
    materima: '材料',
    lampostName: '灯杆名称',
    lamppostModel: '灯杆型号',
    lampheadNumber: '灯头数',
    mem: '备注',
    lampheadColor: '灯杆颜色',
    land: '壁厚'
  }

  function doLightAdjust (precent) {
    var lightIdArray = [];
    lightIdArray.push(globalLightId);

    ajaxRequest("post", "/api/command/sendLightAdjustCommandBatch", transArray({
      "lightPercent": precent,
      "lightIds": lightIdArray
    }), function (data) {
      if (data) {
        if (data.header.code != 1000) {
          layer.msg(data.header.msg, {icon: 2, time: 3000});
        }
      }
    });
  }

  function lightschange (num) {
    var x = 0;
    var LightsUrl = "";
    if (num > 0 && num <= 20) {
      x = 20;
    }
    if (num > 20 && num <= 40) {
      x = 40;
    }
    if (num > 40 && num <= 60) {
      x = 60;
    }
    if (num > 60 && num <= 80) {
      x = 80;
    }
    if (num > 80 && num <= 100) {
      x = 100;
    }
    LightsUrl = "../bg//lightsbg_" + x + ".png";
    $(".imgboximg").attr("src", LightsUrl);
  }

  function addlights (value) {
    $('.imgbox span').html(value + '%')
    $("input[name='range']").val(value);
    $("p[name='rangeval']").html(value);
    lightschange(value);
    doLightAdjust(value);
  }

  function changerange (obj) {
    $('.imgbox span').html(obj.value + '%')
    $("p[name='rangeval']").html(obj.value);
    lightschange(obj.value);
    doLightAdjust(obj.value);
  }

  function powerTypeChangeEvent () {
    ajaxRequest("post", "/api/command/batchCommandConfigTerminalPowerType",
    {"lightUUIDs[0]": $("#uuid").text().trim(), "powerType": $("#powerTypeSelect").val()}, function () {
    });
  }

  function flushLightInfo (eleboxId) {
    $('#eleBoxInfo').DataTable({
      "bStateSave": true,
      "lengthChange": false,
      "destroy": true,
      "searching": false,
      "autoWidth": false,
      "paging": false,
      "bLengthChange": false,
      "info": false,
      "ordering": false, //设置所有布排序
      "ajax": function (data, callback, settings) {
        // ajaxRequest("post", "api/roadlighting/getElebox", {id: eleboxId}, function (data) {
        //   //封装返回数据
        //   var returnData = {};
        //   if (data) {
        //     if (data.header.code == 1000) {
        //       returnData.data = data.body.data;
        //     }
        //   }
        //   callback(returnData);
        // });
        ajaxRequest("post", "/api/roadlighting/getLighting", {"id": globalLightId}, function (data) {
          var d = data.body.data[0]
          var returnData = {}
          returnData.data = []
          Object.keys(data.body.data[0]).forEach(function (e) {
            if (d[e] != null && lampInfoMatch[e]) {
              returnData.data.push({key: lampInfoMatch[e], value: d[e]})
            }
          })
          callback(returnData);
          // if (data) {
          //   if (data.header.code == 1000) {
          //     var light = data.body.data[0];
          //     //刷新灯具信息
          //     $("#longitude").text("经度：" + light.longitude);
          //     $("#latitude").text("  纬度：" + light.latitude);
          //     $("#alarmMessage").text(light.alarmMessage);
          //     $("#communicationMode").text(light.communicationMode);
          //     $("#dimmingMode").text(light.dimmingMode);
          //     $("#equipmentNumber").text(light.equipmentNumber);
          //     $("#UUID").text(light.UUID);
          //     $("#lampModel").text(light.lampModel);
          //     $("#lampName").text(light.lampName);
          //     $("#ratedCurrent").text(light.ratedCurrent);
          //     $("#ratedVoltage").text(light.ratedVoltage);
          //     $("#staticPower").text(light.staticPower);
          //     //注释接口getLightSignalByUUID
          //     //   ajaxRequest("post", "/api/gis/getLightSignalByUUID", {"uuid": light.uid}, function (data) {
          //     //   if (data) {
          //     //     console.log(data);
          //     //     if (data.header.code == 1000) {
          //     //       $("#signalIntensity").text(data.body.data);
          //     //     }
          //     //   }
          //     // })
          //   }
          // }
        });
      },
      "columns": [//返回的json数据在这里填充，注意一定要与上面的<th>数量对应，否则排版出现扭曲
//                { "data": "id" },
        {"data": "key", "defaultContent": ""},
        {"data": "value", "defaultContent": ""}
      ]
    });
  }

  function flushLightPower (eleboxId) {
    $('#flushLightPower').DataTable({
      "bStateSave": true,
      "lengthChange": false,
      "destroy": true,
      "searching": false,
      "autoWidth": false,
      "paging": false,
      "bLengthChange": false,
      "info": false,
      "ordering": false, //设置所有布排序
      "ajax": function (data, callback, settings) {
        var returnData = {}
        var powerData = [];
        var currentDate = new Date();
        var currentHours = currentDate.getHours();
        for (var i = 0; i < 6; i++) {
          powerData.push({
            'c': '功率',
            'v': parseInt(Math.random() * (3000 - 1000) + 1000),
            'd': 'W',
            't': currentHours - i + ':00'
          })
        }
        returnData.data = powerData;
        callback(returnData);
      },
      "columns": [//返回的json数据在这里填充，注意一定要与上面的<th>数量对应，否则排版出现扭曲
//                { "data": "id" },
        {"data": "c", "defaultContent": ""},
        {"data": "v", "defaultContent": ""},
        {"data": "d", "defaultContent": ""},
        {"data": "t", "defaultContent": ""}
      ]
    });
  }

  function flushLampPost (eleboxId) {
    $('#electricEnergy').DataTable({
      "bStateSave": true,
      "lengthChange": false,
      "destroy": true,
      "searching": false,
      "autoWidth": false,
      "paging": false,
      "bLengthChange": false,
      "info": false,
      "ordering": false, //设置所有布排序
      "ajax": function (data, callback, settings) {
        ajaxRequest("post", "/api/deploy/lamppostbylampcontrollerid", {"id": globalLightId}, function (data) {
          var d = data.body.data[0]
          var returnData = {}
          returnData.data = []
          Object.keys(data.body.data[0]).forEach(function (e) {
            if (d[e] != null && lamppostInfoMatch[e]) {
              returnData.data.push({key: lamppostInfoMatch[e], value: d[e]})
            }
          })
          callback(returnData);
        });
      },
      "columns": [//返回的json数据在这里填充，注意一定要与上面的<th>数量对应，否则排版出现扭曲
//                { "data": "id" },
        {"data": "key", "defaultContent": ""},
        {"data": "value", "defaultContent": ""}
      ]
    });
  }

  // //获取灯具信息
  // function flushLightInfo () {
  //   ajaxRequest("post", "/api/roadlighting/getLighting", {"id": globalLightId}, function (data) {
  //
  //     if (data) {
  //       if (data.header.code == 1000) {
  //         var light = data.body.data[0];
  //         //刷新灯具信息
  //         $("#longitude").text("经度：" + light.longitude);
  //         $("#latitude").text("  纬度：" + light.latitude);
  //         $("#alarmMessage").text(light.alarmMessage);
  //         $("#communicationMode").text(light.communicationMode);
  //         $("#dimmingMode").text(light.dimmingMode);
  //         $("#equipmentNumber").text(light.equipmentNumber);
  //         $("#UUID").text(light.UUID);
  //         $("#lampModel").text(light.lampModel);
  //         $("#lampName").text(light.lampName);
  //         $("#ratedCurrent").text(light.ratedCurrent);
  //         $("#ratedVoltage").text(light.ratedVoltage);
  //         $("#staticPower").text(light.staticPower);
  //         //注释接口getLightSignalByUUID
  //         //   ajaxRequest("post", "/api/gis/getLightSignalByUUID", {"uuid": light.uid}, function (data) {
  //         //   if (data) {
  //         //     console.log(data);
  //         //     if (data.header.code == 1000) {
  //         //       $("#signalIntensity").text(data.body.data);
  //         //     }
  //         //   }
  //         // })
  //       }
  //     }
  //   });
  // }

  $(function () {
    $("#tab-system").Huitab({
      index: 0//默认第一个；
    });
    globalLightId = editModel(window.location.href)
    flushLightInfo();
    flushLampPost();
    setInterval(function () {
      flushLightPower();
    }, 300000)
    flushLightPower();
    //通讯方式
    var str1 = '';
    // var str = $('#communicationMode').text();
    var str = parseInt($('#communicationMode').text());
    switch (str) {
      case 1 :
        str1 = 'NB-IoT';
        break;
      case 2 :
        str1 = '4G';
        break;
      case 3 :
        str1 = 'Zigbee';
        break;
      case 4 :
        str1 = 'PLC';
        break;
      case 5 :
        str1 = 'RS485';
        break;
      case 6 :
        str1 = 'GPRS';
        break;
    }
    $('#communicationMode').html(str1);

    //展示调光方式

    var d2 = '';
    // var d1 = $('#dimmingMode').text();
    var d1 = parseInt($('#dimmingMode').text());
    switch (d1) {
      case 1 :
        d2 = 'PWM';
        break;
      case 2 :
        d2 = '0-10V';
        break;
      case 3 :
        d2 = 'YUART';
        break;
      case 4 :
        d2 = 'DALI';
        break;
    }
    $('#dimmingMode').html(d2);
  })

  // function LightAdjustInit (lightId) {
  //   globalLightId = lightId;
  //   flushLightInfo();
  // }

  /*  function checkLeave(){
         return '确定要离开吗？'
     }
     window.onbeforeunload=function(){return '确定要离开吗？'}*/

</script>

</body>
</html>
