<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <title>设备管理-控制柜-添加控制柜型号</title>

    <link rel="stylesheet" type="text/css" href="../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../css/admin.css"/>
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css"/>

</head>
<body>
<article class="page-container">
    <form class="form form-horizontal" id="form-admin-add">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>控制柜编码：</label>
            <div class="formControls col-xs-7 col-sm-8">
                <input type="text" class="input-text" value="" placeholder="控制柜编码" id="codeNumber" name="codeNumber">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>控制柜型号：</label>
            <div class="formControls col-xs-7 col-sm-8">
                <input type="text" class="input-text" value="" placeholder="控制柜型号" id="eleboxModel" name="eleboxModel">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>控制柜名称：</label>
            <div class="formControls col-xs-7 col-sm-8">
                <input type="text" class="input-text" value="" placeholder="控制柜名称" id="eleboxName" name="eleboxName">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>网卡地址：</label>
            <div class="formControls col-xs-7 col-sm-8">
                <input type="text" class="input-text" value="" placeholder="网卡地址" id="networkAddr" name="networkAddr">
            </div>
        </div>
        <!--<div class="row cl">-->
        <!--<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所属区域：</label>-->
        <!--<div class="formControls col-xs-7 col-sm-8">-->
        <!--<select class="input-text" placeholder="所属区域" id="nnlightctlRegionId" name="nnlightctlRegionId">-->
        <!--</select>-->
        <!--</div>-->
        <!--</div>-->
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所属项目：</label>
            <div class="formControls col-xs-7 col-sm-8">
                <select class="input-text" placeholder="所属项目" id="nnlightctlProjectId" name="nnlightctlProjectId">
                </select>

            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>经纬度：</label>
            <div class="formControls col-xs-8 col-sm-7" style="width:593px;">
                <input type="text" class="input-text f-l" value="" placeholder="经度" id="longitude" name="longitude"
                       style="width: 224px;margin-right: 10px;">
                <input type="text" class="input-text f-l" value="" placeholder="纬度" id="latitude" name="latitude"
                       style="width: 224px;margin-right: 10px;">
                <a class="f-l btn btn-primary radius" href="javascript:void(0);" data-title="坐标选择"
                   onclick="site_add('坐标选择', '../Project/Site-Select.html', '700', '600')"
                   style="display: inline-block;line-height: 30px;background:#5b98de;padding: 0 4px;color: #fff;">在地图上选择</a>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">材质：</label>
            <div class="formControls col-xs-8 col-sm-8">
                <input type="text" class="input-text" value="" placeholder="材质" id="materialQuality"
                       name="materialQuality">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">外观颜色：</label>
            <div class="formControls col-xs-8 col-sm-8">
                <input type="text" class="input-text" value="" placeholder="外观颜色" id="eleboxColors" name="eleboxColors">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">尺寸(M)：</label>
            <div class="formControls col-xs-8 col-sm-8">
                <input type="text" class="input-text" value="" placeholder="尺寸" id="eleboxSize" name="eleboxSize">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">备注：</label>
            <div class="formControls col-xs-8 col-sm-8">
                <textarea cols="" rows="" class="textarea" placeholder="说点什么...100个字符以内" dragonfly="true" id="mem"
                          name="mem"></textarea>
                <p class="textarea-numberbar"><!--<em class="textarea-length">0</em>/-->100</p>
            </div>
        </div>
        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>
</article>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript" src="../js/admin.js"></script>

<script type="text/javascript" src="../js/api/requestRoot.js"></script>
<script type="text/javascript" src="../js/api/ajaxScript.js"></script>
<!--/_footer 作为公共模版分离出去-->
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript">
  var currentProjectArr = [];
  var currentCity = '北京';
  $(function () {
    $("#nnlightctlProjectId").change(function () {
      var id = $("#nnlightctlProjectId").val();
      currentProjectArr.length && currentProjectArr.forEach(function (d) {
        if (d.id == id) {
          currentCity = d.cityName
        }
      })
    })

    $.ajax({
      url: BASE_ROOT + "/api/roadlighting/listArea",
      method: 'POST',
      success: function (data) {
        var area = data.body.data
        for (var i = 0; i < area.length; i++) {
          var areaOption = '<option value="' + area[i].id + '">' + area[i].areaName + '</option>';
          $('#nnlightctlRegionId').append(areaOption)
        }
      },
      error: function () {
        alert('获取失败！')
      }
    });
    $.ajax({
      url: BASE_ROOT + "/api/project/listproject",
      method: 'POST',
      success: function (data) {
        var project = data.body.data
        currentProjectArr = data.body.data
        currentCity = currentProjectArr[0].cityName || '北京'
        for (var i = 0; i < project.length; i++) {
          var projectOption = '<option value="' + project[i].id + '">' + project[i].projectName + '</option>';
          $('#nnlightctlProjectId').append(projectOption)
        }
      },
      error: function () {
        alert('获取失败！')
      }
    });
    // ajaxRequest("post", "/api/roadlighting/listArea", function (result) {
    //   //封装返回数据
    //   console.log(result)
    //   var returnData = {};
    //   if (result) {
    //     if (result.header.code == 1000) {
    //       returnData.data = result.body.data;
    //     } else {
    //       layer.msg(data.header.msg, {icon: 2, time: 3000});
    //     }
    //   }
    //   // console.log(returnData)
    // });
    //数据验证
    $("#form-admin-add").validate({
      rules: {
        codeNumber: {
          required: true,
          digits: true,
          rangelength: [17, 17]
        },
        eleboxModel: {
          maxlength: 58,
          required: true
        },
        eleboxName: {
          maxlength: 58,
          required: true
        },
        networkAddr: {
          required: true,
          maxlength: 58
        },
        nnlightctlProjectId: {
          required: true
        },
        longitude: {
          required: true,
          isNumber: true
        },
        latitude: {
          required: true,
          isNumber: true
        },
        materialQuality: {
          maxlength: 20
        },
        eleboxColors: {
          maxlength: 20
        },
        eleboxSize: {
          maxlength: 20
        },
        mem: {
          maxlength: 100
        }
      },
      onkeyup: false,
      focusCleanup: true,
      success: "valid",
      submitHandler: function (form) {
        //ajax上传表单
        //构造上传数据
        var param = {};
        var paramArray = $(form).serializeArray();
        for (var i = 0; i < paramArray.length; ++i) {
          var o = paramArray[i];
          param[o["name"]] = o["value"];
        }
        param["id"] = editModel(window.location.href);
        ajaxRequest("post", "deployElebox/deployAddOrModifyElebox", param, function (data) {
          if (data) {
            if (data.header.code == 1000) {
              if (editModel(window.location.href)) {
                layer.msg("编辑控制柜信息成功！", {icon: 1, time: 3000});
              } else {
                layer.msg("添加控制柜信息成功！", {icon: 1, time: 3000});
              }
              ResetWindow();
            } else {
              layer.msg(data.header.msg, {icon: 2, time: 3000});
            }
          }
        });
      }
    });

    //判断是否编辑模式
    var id = editModel(window.location.href);
    if (id) {
      ajaxRequest("post", "api/roadlighting/getElebox", {"id": id}, function (data) {
        if (data) {
          if (data.header.code == 1000) {
            var lightModel = data.body.data[0];
            //刷新表单
            $("#codeNumber").val(lightModel.codeNumber).attr({"readonly":true});
            $("#eleboxModel").val(lightModel.eleboxModel);
            $("#eleboxName").val(lightModel.eleboxName);
            $("#networkAddr").val(lightModel.networkAddr);
            $("#nnlightctlRegionId").val(lightModel.nnlightctlRegionId);
            $("#nnlightctlProjectId").val(lightModel.nnlightctlProjectId);
            $("#longitude").val(lightModel.longitude);
            $("#latitude").val(lightModel.latitude);
            $("#materialQuality").val(lightModel.materialQuality);
            $("#eleboxColors").val(lightModel.eleboxColors);
            $("#eleboxSize").val(lightModel.eleboxSize);
            $("#mem").val(lightModel.mem);

          } else {
            layer.msg(data.header.msg, {icon: 2});
          }
        }
      });
    }
  });

  /*坐标选择*/
  function site_add (title, url, w, h) {
    layer.open({
      type: 2,
      area: [w + 'px', h + 'px'],
      fix: false, //不固定
      maxmin: true,
      shade: 0.4,
      title: title,
      moveOut: true,
      content: url + "?cityName=" + currentCity,
      btn: ['确定', '关闭'],
      yes: function (index) {
        console.log(index);
        var body = layer.getChildFrame('body', index);
        var lng = body.find('#lng').val();
        var lat = body.find('#lat').val();
        $('#longitude').val(lng - 0.01185);
        $('#latitude').val(lat - 0.00328);
        //最后关闭弹出层
        layer.close(index);
      },
      cancel: function () {
        // 右上角关闭回调
      }
    });
    // layer_show(title, url, w, h, function (layer) {
    //   console.log(layer)
    // });
  }
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>

</html>


